<ion-header>
  <ion-toolbar>
    <ion-title>Delivery</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-segment [(ngModel)]="selectedSegment" (ionChange)="segmentChanged()" class="custom-segment">
    <ion-segment-button value="step1" class="custom-segment-button">
      <ion-label>Step 1</ion-label>
    </ion-segment-button>
    <ion-segment-button value="step2" class="custom-segment-button">
      <ion-label>Step 2</ion-label>
    </ion-segment-button>
  </ion-segment>

  <div class="segment-content">
    <ng-container *ngIf="selectedSegment === 'step1'">
      <!-- Step 1: Select Products and Client Warehouse -->
      <ion-item class="category-selector">
        <ion-label>Categories</ion-label>
        <ion-select [(ngModel)]="selectedCategory" (ionChange)="applyFilters()">
          <ion-select-option *ngFor="let category of categories" [value]="category">
            {{ category.name }}
          </ion-select-option>
        </ion-select>
      </ion-item>
      <ion-grid>
        <ion-row>
          <!-- Main Content Area -->
          <ion-col size="12">
            <ion-card>
              <ion-card-header>
                <ion-card-title>Products</ion-card-title>
              </ion-card-header>
              <ion-card-content>
                <ion-searchbar [(ngModel)]="searchQuery" placeholder="Search Products"></ion-searchbar>
                <ion-grid class="text-black">
                  <ion-row>
                    <ion-col size="3"><strong>Serial Number</strong></ion-col>
                    <ion-col size="3"><strong>Product Name</strong></ion-col>
                    <ion-col size="3"><strong>Status</strong></ion-col>
                    <ion-col size="3"><strong>Select</strong></ion-col>
                  </ion-row>
                  <ion-row *ngFor="let product of filteredProductList | filter: searchQuery" style="border-bottom: 1px solid #ccc;">
                    <ion-col size="3">{{ product.SerialNumber }}</ion-col>
                    <ion-col size="3">{{ product.ProductName }}</ion-col>
                    <ion-col size="3">{{ product.Status }}</ion-col>
                    <ion-col size="3">
                      <ion-checkbox [(ngModel)]="product.selected"></ion-checkbox>
                    </ion-col>
                  </ion-row>
                </ion-grid>
              </ion-card-content>
            </ion-card>
            <!-- Proceed Button -->
            <ion-button expand="block" (click)="openClientDetailsModal()">Proceed</ion-button>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ng-container>

    <ng-container *ngIf="selectedSegment === 'step2'">
      <!-- Client Selection Dropdown -->
      <ion-item class="category-selector">
        <ion-label>Client</ion-label>
        <ion-select [(ngModel)]="selectedClient" (ionChange)="fetchProductsByClient()" placeholder="Select Client">
          <ion-select-option *ngFor="let client of clients" [value]="client.name">{{ client.name }}</ion-select-option>
        </ion-select>
      </ion-item>
    
      <!-- Step 2: Select Products from Warehouse and Deliver to Site -->
      <ion-grid>
        <ion-row>
          <!-- Main Content Area -->
          <ion-col size="9">
            <ion-card>
              <ion-card-header>
                <ion-card-title>Products</ion-card-title>
              </ion-card-header>
              <ion-card-content>
                <ion-searchbar [(ngModel)]="searchQuery" placeholder="Search Products"></ion-searchbar>
                <ion-grid class="text-black">
                  <ion-row>
                    <ion-col size="2.4"><strong>Serial Number</strong></ion-col>
                    <ion-col size="2.4"><strong>Product Name</strong></ion-col>
                    <ion-col size="2.4"><strong>Warehouse</strong></ion-col>
                    <ion-col size="2.4"><strong>Status</strong></ion-col>
                    <ion-col size="2.4"><strong>Select</strong></ion-col>
                  </ion-row>
                  <ion-row *ngFor="let product of clientWarehouseProductData | filter: searchQuery" style="border-bottom: 1px solid #ccc;">
                    <ion-col size="2.4">{{ product.serialNumber }}</ion-col>
                    <ion-col size="2.4">{{ product.productName }}</ion-col>
                    <ion-col size="2.4">{{ product.clientWarehouse }}</ion-col>
                    <ion-col size="2.4">{{ product.status }}</ion-col>
                    <ion-col size="2.4">
                      <ion-checkbox [(ngModel)]="product.selected"></ion-checkbox>
                    </ion-col>
                  </ion-row>
                </ion-grid>
              </ion-card-content>
            </ion-card>
          </ion-col>
    
          <!-- Delivery Form -->
          <ion-col size="3">
            <ion-card>
              <ion-card-header>
                <ion-card-title>Delivery Details</ion-card-title>
              </ion-card-header>
              <ion-card-content>
                <form (ngSubmit)="deliverProductToSite()">
                  <ion-item>
                    <ion-select [(ngModel)]="selectedSite" name="site" placeholder="Select Site">
                      <ion-select-option *ngFor="let site of siteData" [value]="site">{{ site.siteName }}</ion-select-option>
                    </ion-select>
                  </ion-item>
                  <ion-button expand="block" type="submit">Deliver to Site</ion-button>
                </form>
              </ion-card-content>
            </ion-card>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ng-container>
  </div>

  <!-- Client Details Modal -->
<ion-modal [isOpen]="isClientDetailsModalOpen" style="--width: 95%; --height: 95%;">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title>Client Details
            <ion-button (click)="closeClientDetailsModal()">Close</ion-button>
        </ion-title>
      </ion-toolbar>
    </ion-header>
    <ion-content>
      <form (ngSubmit)="deliverProductToWarehouse()">
        <ion-item>
          <ion-label>Client</ion-label>
          <ion-select [(ngModel)]="selectedClient" (ionChange)="fetchClientWarehouses()" name="client" placeholder="Select Client">
            <ion-select-option *ngFor="let client of clients" [value]="client.name">{{ client.name }}</ion-select-option>
          </ion-select>
        </ion-item>
        <ion-item>
          <ion-label>Warehouse</ion-label>
          <ion-select [(ngModel)]="selectedWarehouse" name="warehouse" placeholder="Select Warehouse">
            <ion-select-option *ngFor="let warehouse of warehouseProductData" [value]="warehouse.name">{{ warehouse.name }}</ion-select-option>
          </ion-select>
        </ion-item>
        <ion-item>
          <ion-label>GST Number</ion-label>
          <ion-input [(ngModel)]="gstNumber" name="gstNumber"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label>Billing Client</ion-label>
          <ion-select [(ngModel)]="billingClient" name="billingClient" placeholder="Select Client">
            <ion-select-option *ngFor="let client of clients" [value]="client.name">{{ client.name }}</ion-select-option>
          </ion-select>
        </ion-item>
        <ion-item>
          <ion-label>Billing Warehouse</ion-label>
          <ion-select [(ngModel)]="billingWarehouse" name="billingWarehouse" placeholder="Select Warehouse">
            <ion-select-option *ngFor="let warehouse of warehouseProductData" [value]="warehouse.name">{{ warehouse.name }}</ion-select-option>
          </ion-select>
        </ion-item>
        <ion-item>
          <ion-label>Billing GST Number</ion-label>
          <ion-input [(ngModel)]="billingGstNumber" name="billingGstNumber"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label>Company PAN Number</ion-label>
          <ion-input [(ngModel)]="companyPanNumber" name="companyPanNumber"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label>Dispatched Through</ion-label>
          <ion-input [(ngModel)]="dispatchedThrough" name="dispatchedThrough"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label>Dated</ion-label>
          <ion-datetime [(ngModel)]="dispatchedDate" name="dispatchedDate"></ion-datetime>
        </ion-item>
        <ion-item>
          <ion-label>Mode/Terms of Payment</ion-label>
          <ion-input [(ngModel)]="paymentTerms" name="paymentTerms"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label>Other References</ion-label>
          <ion-input [(ngModel)]="otherReferences" name="otherReferences"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label>Destination</ion-label>
          <ion-input [(ngModel)]="destination" name="destination"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label>Motor Vehicle No</ion-label>
          <ion-input [(ngModel)]="motorVehicleNo" name="motorVehicleNo"></ion-input>
        </ion-item>
        <ion-button (click)="deliverProductToWarehouse()" expand="ion-button" type="submit">Submit</ion-button>
      </form>
    </ion-content>
  </ng-template>
</ion-modal>
</ion-content>
